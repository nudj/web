version: '1.0'

steps:


  # build:
  #   title: Build
  #   type: build
  #   image_name: nudj/web-test
  #   working_directory: ${{main_clone}}
  #   dockerfile: Dockerfile.dev
  #   build_arguments:
  #     - NPM_TOKEN=${{NPM_TOKEN}}
  #
  # test:
  #   title: Test
  #   image: ${{build}}
  #   working_directory: 'IMAGE_WORK_DIR'
  #   commands:
  #     - ./node_modules/.bin/standard
  #     - ./node_modules/.bin/mocha --recursive test/unit

  build_temp:
    title: Build temp
    type: build
    image_name: nudj/web
    tag: production
    dockerfile: Dockerfile
    build_arguments:
      - NPM_TOKEN=${{NPM_TOKEN}}
      - ENVKEY=${{ENVKEY_PRODUCTION}}

  push_ecr:
    title: Push ECR
    type: push
    candidate: ${{build_temp}}
    tag: temp
    provider: 'ecr'
    registry: ecr
    accessKeyId: ${{AWS_ACCESS_KEY_ID}}
    secretAccessKey: ${{AWS_SECRET_ACCESS_KEY}}
    region: ${{AWS_DEFAULT_REGION}}
