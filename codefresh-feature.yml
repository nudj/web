version: '1.0'

steps:

  build:
    title: Build
    type: build
    image_name: nudj/web-test
    working_directory: ${{main_clone}}
    dockerfile: Dockerfile.dev
    build_arguments:
      - NPM_TOKEN=${{NPM_TOKEN}}

  test:
    title: Test
    image: ${{build}}
    working_directory: 'IMAGE_WORK_DIR'
    commands:
      - ./node_modules/.bin/standard
      - ./node_modules/.bin/mocha --recursive test/unit

  push_latest_ecr:
    title: Push ECR
    type: push
    candidate: ${{build}}
    tag: latest
    provider: 'ecr'
    registry: ecr
    accessKeyId: ${{AWS_ACCESS_KEY}}
    secretAccessKey: ${{AWS_SECRET_KEY}}
    region: ${{AWS_REGION}}
