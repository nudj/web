FROM node:6.10.0-alpine
ARG NPM_TOKEN
COPY src/package.json src/.npmrc /tmp/
COPY .cache /tmp/node_modules
RUN cd /tmp && npm i && mkdir -p /usr/src
WORKDIR /usr/src
COPY src /usr/src
EXPOSE 80 81
CMD ln -s /tmp/node_modules ./node_modules && echo '127.0.0.1 api' >> /etc/hosts && ./node_modules/.bin/standard && ./node_modules/.bin/mocha --recursive test
